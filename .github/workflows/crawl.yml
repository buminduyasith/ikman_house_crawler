name: Ikman House Crawler

on:
  # Run on schedule (cron)
  schedule:
    # Runs once daily at 6 PM Sri Lanka time (12:30 PM UTC)
    - cron: "30 12 * * *"

  # Also allow manual trigger from GitHub UI
  workflow_dispatch:

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Run crawler
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          IKMAN_URL: ${{ secrets.IKMAN_URL }}
          DISTRICTS: ${{ secrets.DISTRICTS }}
          PRICE_MIN: ${{ secrets.PRICE_MIN }}
          PRICE_MAX: ${{ secrets.PRICE_MAX }}
          BEDROOMS_MIN: ${{ secrets.BEDROOMS_MIN }}
          BATHROOMS_MIN: ${{ secrets.BATHROOMS_MIN }}
          PAGES: ${{ secrets.PAGES }}
          SEND_LIMIT: ${{ secrets.SEND_LIMIT }}
          MAX_IMAGES: ${{ secrets.MAX_IMAGES }}
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
          LOG_LEVEL: INFO
        run: |
          uv run python main.py
